<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Crossform ‚Ä¢ Calculadora de Cargas</title>
<style>
:root{
 --black:#0b0b0b;--dark:#141414;--gray:#2a2a2a;
 --green:#1db954;--light:#e5e5e5;--active:#2ecc71
}
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--black);color:var(--light)}
.app{max-width:420px;margin:auto;padding:16px}
.logo{text-align:center;font-size:26px;font-weight:900;color:var(--green)}
.subtitle{text-align:center;font-size:12px;color:#aaa;margin-bottom:6px}
.credit{text-align:center;font-size:10px;color:#666;margin-bottom:14px}
label{font-size:12px;color:#aaa;margin-top:12px;display:block}
input,select,button{width:100%;padding:12px;margin-top:6px;border-radius:10px;border:none;font-size:15px;background:var(--gray);color:var(--light)}
button{background:var(--green);color:#000;font-weight:700;margin-top:16px}
.row{display:flex;gap:10px}
.percentages{margin-top:16px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.cell{background:var(--dark);border-radius:10px;padding:10px 6px;text-align:center;font-size:13px;border:1px solid #1f1f1f;cursor:pointer}
.cell.active{background:var(--active);color:#000;font-weight:700}
.cell strong{display:block;font-size:14px}
.checks{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.checks label{font-size:11px;color:#ccc;display:flex;align-items:center;gap:4px}
.result{margin-top:16px;background:var(--dark);padding:12px;border-radius:12px;font-size:13px}
.bar{display:flex;align-items:center;margin-top:10px}
.plate{height:26px;margin:0 2px;border-radius:4px}
.p20{background:#2979ff;width:32px}
.p15{background:#fdd835;width:28px}
.p10{background:#2ecc71;width:24px}
.p5{background:#f5f5f5;width:20px}

/* üîß CORRIGIDO: anilhas pequenas em cinza m√©dio */
.px{background:#8a8a8a;width:16px}

.footer{text-align:center;font-size:11px;color:#666;margin-top:20px}
</style>
</head>
<body>
<div class="app">
<div class="logo">CROSSFORM</div>
<div class="subtitle">Calculadora de cargas ‚Ä¢ Mobile</div>
<div class="credit">Criado por Coach Lu√≠s Ot√°vio Sotareli</div>

<div class="row">
  <div style="flex:2"><label>Exerc√≠cio</label><input id="exercise" placeholder="Back Squat"></div>
  <div style="flex:1"><label>1RM</label><input type="number" id="oneRM"></div>
</div>

<label>Tipo de Barra</label>
<select id="barType">
  <option value="20">Masculina ‚Ä¢ 20kg</option>
  <option value="15">Feminina ‚Ä¢ 15kg</option>
</select>

<label>Anilhas indispon√≠veis</label>
<div class="checks" id="checks"></div>

<button onclick="generatePercentages()">Gerar Percentuais</button>

<div class="percentages" id="percentages"></div>

<label>Carga Manual</label>
<input type="number" id="manualWeight" oninput="manualInput(this.value)">

<div class="result" id="result"></div>
<div class="footer">¬© Crossform</div>
</div>

<script>
const allPlates = [20,15,10,5,3,2.5,2,1.25,1];
let availablePlates = [...allPlates];

const oneRMInput = document.getElementById('oneRM');
const barType = document.getElementById('barType');
const percentages = document.getElementById('percentages');
const manualWeight = document.getElementById('manualWeight');
const result = document.getElementById('result');

const checks = document.getElementById('checks');
allPlates.forEach(p => {
  const l = document.createElement('label');
  l.innerHTML = `<input type='checkbox' checked onchange='togglePlate(${p}, this.checked)'>${p}kg`;
  checks.appendChild(l);
});

function togglePlate(p, on){
  availablePlates = on ? [...new Set([...availablePlates, p])] : availablePlates.filter(x => x !== p);
  availablePlates.sort((a,b) => b - a);
  recalc();
}

function smallestIncrement(){
  const min = Math.min(...availablePlates);
  return min * 2;
}

/* ‚úÖ VERIFICA SE O PESO √â MONT√ÅVEL */
function canAssemble(total, bar){
  if(total <= bar) return false;
  let side = (total - bar) / 2;

  for(let p of availablePlates){
    const count = Math.floor(side / p);
    side -= count * p;
  }
  // toler√¢ncia m√≠nima apenas para erro de ponto flutuante
  return Math.abs(side) < 0.0001;
}

/* ‚úÖ N√ÉO ARREDONDA SE J√Å FOR POSS√çVEL */
function roundToPossible(weight, bar){
  if(canAssemble(weight, bar)) return weight;

  const inc = smallestIncrement();
  let candidate = weight;

  while(!canAssemble(candidate, bar)){
    candidate += inc;
  }
  return candidate;
}

function generatePercentages(){
  const oneRM = parseFloat(oneRMInput.value);
  const bar = parseFloat(barType.value);
  percentages.innerHTML = '';
  if(!oneRM || oneRM <= bar) return;

  for(let p = 25; p <= 100; p += 5){
    const rounded = roundToPossible(oneRM * p / 100, bar);
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.p = p;
    cell.innerHTML = `<strong>${p}%</strong>${rounded}kg`;
    cell.onclick = () => selectPercent(p, rounded);
    percentages.appendChild(cell);
  }
}

function selectPercent(p, weight){
  manualWeight.value = weight;
  highlight(p);
  calculate(weight);
}

function highlight(p){
  document.querySelectorAll('.cell').forEach(c => {
    c.classList.toggle('active', Number(c.dataset.p) === Number(p));
  });
}

function manualInput(value){
  const weight = parseFloat(value);
  if(!weight) return;

  const oneRM = parseFloat(oneRMInput.value);
  if(oneRM){
    const perc = (weight / oneRM) * 100;
    highlight(closestPercent(perc));
  }
  calculate(weight);
}

function closestPercent(p){
  let closest = 25;
  for(let i = 25; i <= 100; i += 5){
    if(Math.abs(i - p) < Math.abs(closest - p)) closest = i;
  }
  return closest;
}

function calculate(total){
  const bar = parseFloat(barType.value);
  if(total <= bar){ result.innerHTML = ''; return; }

  let side = (total - bar) / 2;
  let used = [];

  for(let p of availablePlates){
    const count = Math.floor(side / p);
    if(count > 0){
      used.push([p, count]);
      side -= count * p;
    }
  }

  if(side > 0.01){
    result.innerHTML = 'Carga n√£o mont√°vel com as anilhas dispon√≠veis.';
    return;
  }

  result.innerHTML = `<strong>Peso total:</strong> ${total}kg<br><strong>Montagem por lado:</strong>`;
  used.forEach(([p,c]) => result.innerHTML += `<br>${c} √ó ${p}kg`);

  const barDiv = document.createElement('div');
  barDiv.className = 'bar';

  used.forEach(([p,c]) => {
    for(let i = 0; i < c; i++){
      const d = document.createElement('div');
      d.className = 'plate ' + plateClass(p);
      barDiv.appendChild(d);
    }
  });

  result.appendChild(barDiv);
}

function plateClass(p){
  if(p === 20) return 'p20';
  if(p === 15) return 'p15';
  if(p === 10) return 'p10';
  if(p === 5)  return 'p5';
  return 'px';
}

function recalc(){
  if(manualWeight.value) calculate(parseFloat(manualWeight.value));
}
</script>
</body>
</html>

